#!/bin/bash

if [ "$1" ]; then
  EVA_DIR=$1
  D=`realpath $0`
  MY_DIR=`dirname ${D}`
else
  D=`realpath $0`
  MY_DIR=`dirname ${D}`
  EVA_DIR=${MY_DIR}/..
  cd ${EVA_DIR}
fi

EVA_DIR=`realpath ${EVA_DIR}`

if [ ! -f ${EVA_DIR}/python3/bin/pip3 ]; then
  [ -d ${EVA_DIR}/python3 ] && rm -rf ${EVA_DIR}/python3
  python3 -m venv --without-pip ${EVA_DIR}/python3 || exit 2
  source ${EVA_DIR}/python3/bin/activate
  ( curl https://bootstrap.pypa.io/get-pip.py | python ) || exit 3
  deactivate
fi

PIP=${EVA_DIR}/python3/bin/pip3

${PIP} install -r ${MY_DIR}/mods.list || exit 4
exit 0
