LM RESTful API
****************

:doc:`Logic Manager<lm>` API is used to manage lvars, rules and other logic elements

This document describes API methods for RESTful calls. For direct and JSON RPC
calls look :doc:`/lm/lm_api`.

RESTful API basics
==================

Majority EVA ICS API components and items support `REST
<https://en.wikipedia.org/wiki/Representational_state_transfer>`_. Parameters
for *POST, PUT, PATCH* and *DELETE* requests can be sent in both JSON and
multipart/form-data. For JSON, *Content-Type: application/json* header must be
specified.

Requests
--------

API key can be sent in HTTP **X-Auth-Key** header (preferred) or in request
parameters (as **k**).

* **GET** request is used to get information about resource or list of
  resources of the specified type.
* **POST** request is used to perform special API calls and create resources in
  case when resource id is generated by server. In the last case, response
  always contains additional field *Location* which points to the resource
  created.
* **PUT** request is used to create new resources. If resource already exists,
  the server could refuse recreating it, responding with **409 Conflict** HTTP
  error. 
* **PATCH** request is used to modify resource parameters.
* **DELETE** request is used to delete resource.
  
For resource creation and modification, multiple parameters can be specified in
a single request. For majority requests of such purpose, a special parameter
*"save"* is used to tell server (if *"save": true*) to save the resource
configuration immediately after its modification.

For the group-related calls, put trailing slash at the end of the request URL:

    /r/<resource_type>/<group>/

Responses
---------

**Success responses:**

* **200 OK** API call completed successfully
* **201 Created** API call completed successfully, Response header
  *Location* contains either uri to the newly created object or resource is
  accessible by the effective request uri. For resources created with *PUT*,
  body contains either serialized resource object or resource type and id
* **202 Accepted** The server accepted command and will process it later.
* **204 No Content** API call completed successfully, no content to return

**Error responses:**

* **403 Forbidden** the API key has no access to this function or resource
* **404 Not Found** resource doesn't exist
* **405 Method Not Allowed** API function/method not found
* **409 Conflict** resource/object already exists or is locked
* **500 API Error** API function execution has been failed. Check
  input parameters and server logs.

Response body may contain additional information encoded in JSON. *{
"result": "OK" }* and *{ "result": "ERROR" }* in body are not returned.

.. contents::

.. _lmapi_restful_cat_general:

General functions
=================



.. _lmapi_restful_test:

test API/key and get system info
--------------------------------

Test can be executed with any valid API key of the controller the function is called to.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/test.rest
    :response: http-examples/lmapi/test.resp-rest

Parameters:

* **API Key** any valid API key

Returns:

JSON dict with system info and current API key permissions (for masterkey only { "master": true } is returned)


.. _lmapi_restful_save:

save database and runtime configuration
---------------------------------------

All modified items, their status, and configuration will be written to the disk. If **exec_before_save** command is defined in the controller's configuration file, it's called before saving and **exec_after_save** after (e.g. to switch the partition to write mode and back to read-only).

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/save.rest
    :response: http-examples/sysapi/save.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions


.. _lmapi_restful_cmd:

execute a remote system command
-------------------------------

Executes a :ref:`command script<cmd>` on the server where the controller is installed.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/cmd.rest
    :response: http-examples/sysapi/cmd.resp-rest

Parameters:

* **API Key** API key with *allow=cmd* permissions

Optionally:

* **a** string of command arguments, separated by spaces (passed to the script)
* **w** wait (in seconds) before API call sends a response. This allows to try waiting until command finish
* **t** maximum time of command execution. If the command fails to finish within the specified time (in sec), it will be terminated


.. _lmapi_restful_shutdown_core:

shutdown the controller
-----------------------

Controller process will be exited and then (should be) restarted by watchdog. This allows to restart controller remotely.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/shutdown_core.rest
    :response: http-examples/sysapi/shutdown_core.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_set_debug:

switch debugging mode
---------------------

Enables and disables debugging mode while the controller is running. After the controller is restarted, this parameter is lost and controller switches back to the mode specified in the configuration file.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_debug.rest
    :response: http-examples/sysapi/set_debug.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **debug** true for enabling debug mode, false for disabling


.. _lmapi_restful_login:

log in and get authentication token
-----------------------------------

Obtains authentication :doc:`token</api_tokens>` which can be used in API calls instead of API key.

If both **k** and **u** args are absent, but API method is called with HTTP request, which contain HTTP header for basic authorization, the function will try to parse it and log in user with credentials provided.

If authentication token is specified, the function will check it and return token information if it is valid.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/login.rest
    :response: http-examples/lmapi/login.resp-rest

Parameters:

* **API Key** valid API key or
* **u** user login
* **p** user password
* **a** authentication token

Returns:

A dict, containing API key ID and authentication token


.. _lmapi_restful_logout:

log out and purge authentication token
--------------------------------------

Purges authentication :doc:`token</api_tokens>`

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/logout.rest
    :response: http-examples/lmapi/logout.resp-rest

Parameters:

* **API Key** valid token



.. _lmapi_restful_cat_lvar:

LVar functions
==============



.. _lmapi_restful_clear:

clear lvar state
----------------

set status (if **expires** lvar param > 0) or value (if **expires** isn't set) of a :ref:`logic variable<lvar>` to *0*. Useful when lvar is used as a timer to stop it, or as a flag to set it *False*.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/clear.rest
    :response: http-examples/lmapi/clear.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_decrement:

decrement lvar value
--------------------

Decrement value of a :ref:`logic variable<lvar>`. Initial value should be number

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/decrement.rest
    :response: http-examples/lmapi/decrement.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_groups:

get item group list
-------------------

Get the list of item groups. Useful e.g. for custom interfaces.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/groups.rest
    :response: http-examples/lmapi/groups.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_state_history:

get item state history
----------------------

State history of one :doc:`item</items>` or several items of the specified type can be obtained using **state_history** command.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/state_history.rest
    :response: http-examples/lmapi/state_history.resp-rest

Parameters:

* **API Key** valid API key
* **a** history notifier id (default: db_1)

Optionally:

* **s** start time (timestamp or ISO)
* **e** end time (timestamp or ISO)
* **l** records limit (doesn't work with "w")
* **x** state prop ("status" or "value")
* **t** time format("iso" or "raw" for unix timestamp, default is "raw")
* **w** fill frame with the interval (e.g. "1T" - 1 min, "2H" - 2 hours etc.), start time is required
* **g** output format ("list", "dict" or "chart", default is "list")
* **c** options for chart (dict or comma separated)

Returns:

history data in specified format or chart image.

For chart, JSON RPC gets reply with "content_type" and "data" fields, where content is image content type. If PNG image format is selected, data is base64-encoded.

Options for chart (all are optional):

* type: chart type (line or bar, default is line)

* tf: chart time format

* out: output format (svg, png, default is svg),

* style: chart style (without "Style" suffix, e.g. Dark)

* other options: http://pygal.org/en/stable/documentation/configuration/chart.html#options (use range_min, range_max for range, other are passed as-is)

If option "w" (fill) is used, number of digits after comma may be specified. E.g. 5T:3 will output values with 3 digits after comma.

Additionally, SI prefix may be specified to convert value to kilos, megas etc, e.g. 5T:k:3 - divide value by 1000 and output 3 digits after comma. Valid prefixes are: k, M, G, T, P, E, Z, Y.

If binary prefix is required, it should be followed by "b", e.g. 5T:Mb:3 - divide value by 2^20 and output 3 digits after comma.


.. _lmapi_restful_state:

get lvar state
--------------

State of lvar or all lvars can be obtained using state command.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/state.rest
    :response: http-examples/lmapi/state.resp-rest

Parameters:

* **API Key** valid API key

Optionally:



.. _lmapi_restful_increment:

increment lvar value
--------------------

Increment value of a :ref:`logic variable<lvar>`. Initial value should be number

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/increment.rest
    :response: http-examples/lmapi/increment.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_reset:

reset lvar state
----------------

Set status and value of a :ref:`logic variable<lvar>` to *1*. Useful when lvar is being used as a timer to reset it, or as a flag to set it *True*.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/reset.rest
    :response: http-examples/lmapi/reset.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_set:

set lvar state
--------------

Set status and value of a :ref:`logic variable<lvar>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set.rest
    :response: http-examples/lmapi/set.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **s** lvar status
* **v** lvar value


.. _lmapi_restful_toggle:

toggle lvar state
-----------------

switch value of a :ref:`logic variable<lvar>` between *0* and *1*. Useful when lvar is being used as a flag to switch it between *True*/*False*.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/toggle.rest
    :response: http-examples/lmapi/toggle.resp-rest

Parameters:

* **API Key** valid API key



.. _lmapi_restful_cat_lvar-management:

LVar management
===============



.. _lmapi_restful_list:

list lvars
----------



Parameters:

* **API Key** API key with *master* permissions

Optionally:


Returns:

the list of all :ref:`lvars<lvar>` available


.. _lmapi_restful_create_lvar:

create lvar
-----------

Create new :ref:`lvar<lvar>`

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/create_lvar.rest
    :response: http-examples/lmapi/create_lvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save lvar configuration immediately


.. _lmapi_restful_destroy_lvar:

delete lvar
-----------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/destroy_lvar.rest
    :response: http-examples/lmapi/destroy_lvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_get_config:

get lvar configuration
----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_config.rest
    :response: http-examples/lmapi/get_config.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

complete :ref:`lvar<lvar>` configuration.


.. _lmapi_restful_list_props:

list lvar properties
--------------------

Get all editable parameters of the :ref:`lvar<lvar>` confiugration.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_props.rest
    :response: http-examples/lmapi/list_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_save_config:

save lvar configuration
-----------------------

Saves :ref:`lvar<lvar>`. configuration on disk (even if it hasn't been changed)

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/save_config.rest
    :response: http-examples/lmapi/save_config.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_set_prop:

set lvar property
-----------------

Set configuration parameters of the :ref:`lvar<lvar>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_prop.rest
    :response: http-examples/lmapi/set_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call



.. _lmapi_restful_cat_rule:

Decision matrix rules
=====================



.. _lmapi_restful_create_rule:

create new rule
---------------

Creates new :doc:`decision rule<decision_matrix>`. Rule id (UUID) is generated automatically unless specified.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/create_rule.rest
    :response: http-examples/lmapi/create_rule.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save rule configuration immediately


.. _lmapi_restful_destroy_rule:

delete rule
-----------

Deletes :doc:`decision rule<decision_matrix>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/destroy_rule.rest
    :response: http-examples/lmapi/destroy_rule.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_get_rule:

get rule information
--------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_rule.rest
    :response: http-examples/lmapi/get_rule.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_list_rules:

get rules list
--------------

Get the list of all available :doc:`decision rules<decision_matrix>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_rules.rest
    :response: http-examples/lmapi/list_rules.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_list_rule_props:

list rule properties
--------------------

Get all editable parameters of the :doc:`decision rule</lm/decision_matrix>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_rule_props.rest
    :response: http-examples/lmapi/list_rule_props.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_set_rule_prop:

set rule parameters
-------------------

Set configuration parameters of the :doc:`decision rule</lm/decision_matrix>`.

.. note::

    Master key is required for batch set.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_rule_prop.rest
    :response: http-examples/lmapi/set_rule_prop.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **save** save configuration after successful call



.. _lmapi_restful_cat_macro:

Logic control macros
====================



.. _lmapi_restful_create_macro:

create new macro
----------------

Creates new :doc:`macro<macros>`. Macro code should be put in **xc/lm** manually.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/create_macro.rest
    :response: http-examples/lmapi/create_macro.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:



.. _lmapi_restful_destroy_macro:

delete macro
------------

Deletes :doc:`macro<macros>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/destroy_macro.rest
    :response: http-examples/lmapi/destroy_macro.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_run:

execute macro
-------------

Execute a :doc:`macro<macros>` with the specified arguments.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/run.rest
    :response: http-examples/lmapi/run.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **a** macro arguments, array or space separated
* **kw** macro keyword arguments, name=value, comma separated or dict
* **w** wait for the completion for the specified number of seconds
* **p** queue priority (default is 100, lower is better)
* **q** global queue timeout, if expires, action is marked as "dead"


.. _lmapi_restful_list_macro_props:

get macro configuration properties
----------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_macro_props.rest
    :response: http-examples/lmapi/list_macro_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_groups_macro:

get macro groups list
---------------------

Get the list of macros. Useful e.g. for custom interfaces.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/groups_macro.rest
    :response: http-examples/lmapi/groups_macro.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_get_macro:

get macro information
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_macro.rest
    :response: http-examples/lmapi/get_macro.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_list_macros:

get macro list
--------------

Get the list of all available :doc:`macros<macros>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_macros.rest
    :response: http-examples/lmapi/list_macros.resp-rest

Parameters:

* **API Key** valid API key

Optionally:



.. _lmapi_restful_result:

macro execution result
----------------------

Get :doc:`macro<macros>` execution results either by action uuid or by macro id.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/result.rest
    :response: http-examples/lmapi/result.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **g** filter by unit group
* **s** filter by action status: Q for queued, R for running, F for finished

Returns:

list or single serialized action object


.. _lmapi_restful_set_macro_prop:

set macro configuration property
--------------------------------

Set configuration parameters of the :doc:`macro<macros>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_macro_prop.rest
    :response: http-examples/lmapi/set_macro_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call



.. _lmapi_restful_cat_cycle:

Logic cycles
============



.. _lmapi_restful_create_cycle:

create new cycle
----------------

Creates new :doc:`cycle<cycles>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/create_cycle.rest
    :response: http-examples/lmapi/create_cycle.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:



.. _lmapi_restful_destroy_cycle:

delete cycle
------------

Deletes :doc:`cycle<cycles>`. If cycle is running, it is stopped before deletion.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/destroy_cycle.rest
    :response: http-examples/lmapi/destroy_cycle.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_cycle_props:

get cycle configuration properties
----------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_cycle_props.rest
    :response: http-examples/lmapi/list_cycle_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_groups_cycle:

get cycle groups list
---------------------

Get the list of cycles. Useful e.g. for custom interfaces.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/groups_cycle.rest
    :response: http-examples/lmapi/groups_cycle.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_get_cycle:

get cycle information
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_cycle.rest
    :response: http-examples/lmapi/get_cycle.resp-rest

Parameters:

* **API Key** valid API key

Returns:

field "value" contains real average cycle interval


.. _lmapi_restful_list_cycles:

get cycle list
--------------

Get the list of all available :doc:`cycles<cycles>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_cycles.rest
    :response: http-examples/lmapi/list_cycles.resp-rest

Parameters:

* **API Key** valid API key

Optionally:



.. _lmapi_restful_reset_cycle_stats:

reset cycle statistic
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/reset_cycle_stats.rest
    :response: http-examples/lmapi/reset_cycle_stats.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_set_cycle_prop:

set cycle property
------------------

Set configuration parameters of the :doc:`cycle<cycles>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_cycle_prop.rest
    :response: http-examples/lmapi/set_cycle_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _lmapi_restful_start_cycle:

start cycle
-----------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/start_cycle.rest
    :response: http-examples/lmapi/start_cycle.resp-rest

Parameters:

* **API Key** valid API key


.. _lmapi_restful_stop_cycle:

stop cycle
----------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/stop_cycle.rest
    :response: http-examples/lmapi/stop_cycle.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **wait** wait until cycle is stopped



.. _lmapi_restful_cat_ext:

Macro extensions
================



.. _lmapi_restful_modinfo_ext:

get extension module info
-------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/modinfo_ext.rest
    :response: http-examples/lmapi/modinfo_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_modhelp_ext:

get extension usage help
------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/modhelp_ext.rest
    :response: http-examples/lmapi/modhelp_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_ext_mods:

get list of available extension modules
---------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_ext_mods.rest
    :response: http-examples/lmapi/list_ext_mods.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_ext:

get list of available macro extensions
--------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_ext.rest
    :response: http-examples/lmapi/list_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:



.. _lmapi_restful_get_ext:

get loaded extension information
--------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_ext.rest
    :response: http-examples/lmapi/get_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_load_ext:

load extension module
---------------------

Loads:doc:`macro extension</lm/ext>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/load_ext.rest
    :response: http-examples/lmapi/load_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **m** extension module

Optionally:

* **c** extension configuration
* **save** save extension configuration after successful call


.. _lmapi_restful_set_ext_prop:

set extension configuration property
------------------------------------

appends property to extension configuration and reloads module

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_ext_prop.rest
    :response: http-examples/lmapi/set_ext_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _lmapi_restful_unload_ext:

unload macro extension
----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/unload_ext.rest
    :response: http-examples/lmapi/unload_ext.resp-rest

Parameters:

* **API Key** API key with *master* permissions



.. _lmapi_restful_cat_remotes:

Remote controllers
==================



.. _lmapi_restful_append_controller:

connect remote UC via HTTP
--------------------------

Connects remote :ref:`UC controller<lm_remote_uc>` to the local.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/append_controller.rest
    :response: http-examples/lmapi/append_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **u** :doc:`/uc/uc_api` uri (*proto://host:port*, port not required if default)
* **a** remote controller API key (\$key to use local key)

Optionally:

* **m** ref:`MQTT notifier<mqtt_>` to exchange item states in real time (default: *eva_1*)
* **s** verify remote SSL certificate or pass invalid
* **t** timeout (seconds) for the remote controller API calls
* **save** save connected controller configuration on the disk immediately after creation


.. _lmapi_restful_disable_controller:

disable connected controller
----------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/disable_controller.rest
    :response: http-examples/lmapi/disable_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _lmapi_restful_remove_controller:

disconnect controller
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/remove_controller.rest
    :response: http-examples/lmapi/remove_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_enable_controller:

enable connected controller
---------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/enable_controller.rest
    :response: http-examples/lmapi/enable_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _lmapi_restful_list_remote:

get a list of items from connected UCs
--------------------------------------

Get a list of the items loaded from the connected :ref:`UC controllers<lm_remote_uc>`. Useful to debug the controller connections.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_remote.rest
    :response: http-examples/lmapi/list_remote.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **g** filter by item group
* **p** filter by item type


.. _lmapi_restful_get_controller:

get connected controller information
------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_controller.rest
    :response: http-examples/lmapi/get_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_controller_props:

get controller connection parameters
------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_controller_props.rest
    :response: http-examples/lmapi/list_controller_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_controllers:

get controllers list
--------------------

Get the list of all connected :ref:`UC controllers<lm_remote_uc>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_controllers.rest
    :response: http-examples/lmapi/list_controllers.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_reload_controller:

reload controller
-----------------

Reloads items from connected UC

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/reload_controller.rest
    :response: http-examples/lmapi/reload_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_set_controller_prop:

set controller connection parameters
------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_controller_prop.rest
    :response: http-examples/lmapi/set_controller_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _lmapi_restful_test_controller:

test connection to remote controller
------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/test_controller.rest
    :response: http-examples/lmapi/test_controller.resp-rest

Parameters:

* **API Key** API key with *master* permissions



.. _lmapi_restful_cat_job:

Scheduled jobs
==============



.. _lmapi_restful_create_job:

create new job
--------------

Creates new :doc:`scheduled job<jobs>`. Job id (UUID) is generated automatically unless specified.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/create_job.rest
    :response: http-examples/lmapi/create_job.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save unit configuration immediately


.. _lmapi_restful_destroy_job:

delete job
----------

Deletes :doc:`scheduled job<jobs>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/destroy_job.rest
    :response: http-examples/lmapi/destroy_job.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_get_job:

get job information
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/get_job.rest
    :response: http-examples/lmapi/get_job.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_jobs:

get jobs list
-------------

Get the list of all available :doc:`scheduled jobs<jobs>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_jobs.rest
    :response: http-examples/lmapi/list_jobs.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_job_props:

list job properties
-------------------

Get all editable parameters of the :doc:`scheduled job</lm/jobs>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/list_job_props.rest
    :response: http-examples/lmapi/list_job_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_set_job_prop:

set job parameters
------------------

Set configuration parameters of the :doc:`scheduled job</lm/jobs>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/lmapi/set_job_prop.rest
    :response: http-examples/lmapi/set_job_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call



.. _lmapi_restful_cat_cvar:

CVARs
=====



.. _lmapi_restful_get_cvar:

get the value of user-defined variable
--------------------------------------

.. note::

    Even if different EVA controllers are working on the same     server, they have different sets of variables To set the variables     for each subsystem, use SYS API on the respective address/port.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_cvar.rest
    :response: http-examples/sysapi/get_cvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:


Returns:

Dict containing variable and its value. If no varible name was specified, all cvars are returned.


.. _lmapi_restful_set_cvar:

set the value of user-defined variable
--------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_cvar.rest
    :response: http-examples/sysapi/set_cvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **v** variable value (if not specified, variable is deleted)



.. _lmapi_restful_cat_lock:

Locking functions
=================



.. _lmapi_restful_lock:

acquire lock
------------

Locks can be used similarly to file locking by the specific process. The difference is that SYS API tokens can be:

* centralized for several systems (any EVA server can act as lock     server)

* removed from outside

* automatically unlocked after the expiration time, if the initiator     failed or forgot to release the lock

used to restrict parallel process starting or access to system files/resources. LM PLC :doc:`macro</lm/macros>` share locks with extrnal scripts.

.. note::

    Even if different EVA controllers are working on the same server,     their lock tokens are stored in different bases. To work with the     token of each subsystem, use SYS API on the respective     address/port.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/lock.rest
    :response: http-examples/sysapi/lock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions

Optionally:

* **t** maximum time (seconds) to acquire lock
* **e** time after which lock is automatically released (if absent, lock may be released only via unlock function)


.. _lmapi_restful_get_lock:

get lock status
---------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_lock.rest
    :response: http-examples/sysapi/get_lock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions


.. _lmapi_restful_unlock:

release lock
------------

Releases the previously acquired lock.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/unlock.rest
    :response: http-examples/sysapi/unlock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions



.. _lmapi_restful_cat_logs:

Logging
=======



.. _lmapi_restful_log:

put message to log file
-----------------------

An external application can put a message in the logs on behalf of the controller.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log.rest
    :response: http-examples/sysapi/log.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **l** log level
* **m** message text


.. _lmapi_restful_log_debug:

put debug message to log file
-----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _lmapi_restful_log_info:

put info message to log file
----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _lmapi_restful_log_warning:

put warning message to log file
-------------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _lmapi_restful_log_error:

put error message to log file
-----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _lmapi_restful_log_critical:

put critical message to log file
--------------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _lmapi_restful_log_get:

get records from the controller log
-----------------------------------

Log records are stored in the controllers’ memory until restart or the time (keep_logmem) specified in controller configuration passes.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log_get.rest
    :response: http-examples/sysapi/log_get.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions

Optionally:

* **t** get log records not older than t seconds
* **n** the maximum number of log records you want to obtain


.. _lmapi_restful_log_rotate:

rotate log file
---------------

Equal to kill -HUP <controller_process_pid>.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log_rotate.rest
    :response: http-examples/sysapi/log_rotate.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions



.. _lmapi_restful_cat_keys:

API keys
========



.. _lmapi_restful_create_key:

create API key
--------------

API keys are defined statically in etc/<controller>_apikeys.ini file as well as can be created with API and stored in user database.

Keys with master permission can not be created.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/create_key.rest
    :response: http-examples/sysapi/create_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **save** save configuration immediately

Returns:

JSON with serialized key object


.. _lmapi_restful_destroy_key:

delete API key
--------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/destroy_key.rest
    :response: http-examples/sysapi/destroy_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_key_props:

list API key permissions
------------------------

Lists API key permissons (including a key itself)

.. note::

    API keys, defined in etc/<controller>_apikeys.ini file can not be     managed with API.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_key_props.rest
    :response: http-examples/sysapi/list_key_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **save** save configuration immediately


.. _lmapi_restful_list_keys:

list API keys
-------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_keys.rest
    :response: http-examples/sysapi/list_keys.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_regenerate_key:

regenerate API key
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/regenerate_key.rest
    :response: http-examples/sysapi/regenerate_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

JSON dict with new key value in "key" field


.. _lmapi_restful_set_key_prop:

set API key permissions
-----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_key_prop.rest
    :response: http-examples/sysapi/set_key_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** property
* **v** value (if none, permission will be revoked)
* **save** save configuration immediately



.. _lmapi_restful_cat_users:

User accounts
=============



.. _lmapi_restful_set_user_key:

assign API key to user
----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_user_key.rest
    :response: http-examples/sysapi/set_user_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **a** API key to assign (key id, not a key itself)


.. _lmapi_restful_create_user:

create user account
-------------------

.. note::

    All changes to user accounts are instant, if the system works in     read/only mode, set it to read/write before performing user     management.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/create_user.rest
    :response: http-examples/sysapi/create_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** user password
* **a** API key to assign (key id, not a key itself)


.. _lmapi_restful_destroy_user:

delete user account
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/destroy_user.rest
    :response: http-examples/sysapi/destroy_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_get_user:

get user account info
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_user.rest
    :response: http-examples/sysapi/get_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_users:

list user accounts
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_users.rest
    :response: http-examples/sysapi/list_users.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_set_user_password:

set user password
-----------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_user_password.rest
    :response: http-examples/sysapi/set_user_password.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** new password



.. _lmapi_restful_cat_notifiers:

Notifier management
===================



.. _lmapi_restful_disable_notifier:

disable notifier
----------------

.. note::

    The notifier is disabled until controller restart. To disable     notifier permanently, use notifier management CLI.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/disable_notifier.rest
    :response: http-examples/sysapi/disable_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_enable_notifier:

enable notifier
---------------

.. note::

    The notifier is enabled until controller restart. To enable     notifier permanently, use notifier management CLI.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/enable_notifier.rest
    :response: http-examples/sysapi/enable_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_get_notifier:

get notifier configuration
--------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_notifier.rest
    :response: http-examples/sysapi/get_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_list_notifiers:

list notifiers
--------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_notifiers.rest
    :response: http-examples/sysapi/list_notifiers.resp-rest

Parameters:

* **API Key** API key with *master* permissions



.. _lmapi_restful_cat_files:

File management
===============



.. _lmapi_restful_file_put:

put file to runtime folder
--------------------------

Puts a new file into runtime folder. If the file with such name exists, it will be overwritten. As all files in runtime are text, binary data can not be put.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_put.rest
    :response: http-examples/sysapi/file_put.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **m** file content


.. _lmapi_restful_file_set_exec:

set file exec permission
------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_set_exec.rest
    :response: http-examples/sysapi/file_set_exec.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **e** *false* for 0x644, *true* for 0x755 (executable)


.. _lmapi_restful_file_unlink:

delete file from runtime folder
-------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_unlink.rest
    :response: http-examples/sysapi/file_unlink.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _lmapi_restful_file_get:

get file contents from runtime folder
-------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_get.rest
    :response: http-examples/sysapi/file_get.resp-rest

Parameters:

* **API Key** API key with *master* permissions


