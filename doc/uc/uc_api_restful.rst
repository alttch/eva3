UC RESTful API
****************

:doc:`Universal Controller<uc>` API is used to control and manage units and sensors

This document describes API methods for RESTful calls. For direct and JSON RPC
calls look :doc:`/uc/uc_api`.

RESTful API basics
==================

.. warning::

    RESTful API is deprecated and scheduled to be removed (not implemented) in
    EVA ICS v4. Use JSON RPC API, whenever it is possible.

Majority EVA ICS API components and items support `REST
<https://en.wikipedia.org/wiki/Representational_state_transfer>`_. Parameters
for *POST, PUT, PATCH* and *DELETE* requests can be sent in both JSON and
multipart/form-data. For JSON, *Content-Type: application/json* header must be
specified.

Requests
--------

API key can be sent in HTTP **X-Auth-Key** header (preferred) or in request
parameters (as **k**).

* **GET** request is used to get information about resource or list of
  resources of the specified type.
* **POST** request is used to perform special API calls and create resources in
  case when resource id is generated by server. In the last case, response
  always contains additional field *Location* which points to the resource
  created.
* **PUT** request is used to create new resources. If resource already exists,
  the server could refuse recreating it, responding with **409 Conflict** HTTP
  error. 
* **PATCH** request is used to modify resource parameters.
* **DELETE** request is used to delete resource.
  
For resource creation and modification, multiple parameters can be specified in
a single request. For majority requests of such purpose, a special parameter
*"save"* is used to tell server (if *"save": true*) to save the resource
configuration immediately after its modification.

For the group-related calls, put trailing slash at the end of the request URL:

    /r/<resource_type>/<group>/

Responses
---------

**Success responses:**

* **200 OK** API call completed successfully
* **201 Created** API call completed successfully, Response header
  *Location* contains either uri to the newly created object or resource is
  accessible by the effective request uri. For resources created with *PUT*,
  body contains either serialized resource object or resource type and id
* **202 Accepted** The server accepted command and will process it later.
* **204 No Content** API call completed successfully, no content to return

**Error responses:**

* **403 Forbidden** the API key has no access to this function or resource
* **404 Not Found** resource doesn't exist
* **405 Method Not Allowed** API function/method not found
* **409 Conflict** resource/object already exists or is locked
* **500 API Error** API function execution has been failed. Check
  input parameters and server logs.

Response body may contain additional information encoded in JSON. *{
"result": "OK" }* and *{ "result": "ERROR" }* in body are not returned.

Long API calls
--------------

* Long API calls should be avoided at any cost.

* All critical action and command methods have an option to obtain action ID
  and check for the result later.

* If long API calls are performed between controllers (e.g. action methods with
  *wait* param), remote controller timeout should be always greater than max.
  expected "wait" timeout in API call, otherwise client controller will repeat
  API calls continuously, up to max **retries** for the target controller.

.. contents::

.. _ucapi_restful_cat_general:

General functions
=================



.. _ucapi_restful_test:

test API/key and get system info
--------------------------------

Test can be executed with any valid API key of the controller the function is called to.

For SFA, the result section "connected" contains connection status of remote controllers. The API key must have an access either to "uc" and "lm" groups ("remote_uc:uc" and "remote_lm:lm") or to particular controller oids.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/test.rest
    :response: http-examples/ucapi/test.resp-rest

Parameters:

* **API Key** any valid API key

Returns:

JSON dict with system info and current API key permissions (for masterkey only { "master": true } is returned)


.. _ucapi_restful_save:

save database and runtime configuration
---------------------------------------

All modified items, their status, and configuration will be written to the disk. If **exec_before_save** command is defined in the controller's configuration file, it's called before saving and **exec_after_save** after (e.g. to switch the partition to write mode and back to read-only).

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/save.rest
    :response: http-examples/sysapi/save.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions


.. _ucapi_restful_clear_lang_cache:

Clear language cache
--------------------




.. _ucapi_restful_cmd:

execute a remote system command
-------------------------------

Executes a :ref:`command script<cmd>` on the server where the controller is installed.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/cmd.rest
    :response: http-examples/sysapi/cmd.resp-rest

Parameters:

* **API Key** API key with *allow=cmd* permissions

Optionally:

* **a** string of command arguments, separated by spaces (passed to the script) or array (list)
* **w** wait (in seconds) before API call sends a response. This allows to try waiting until command finish
* **t** maximum time of command execution. If the command fails to finish within the specified time (in sec), it will be terminated
* **s** STDIN data


.. _ucapi_restful_list_plugins:

get list of loaded core plugins
-------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_plugins.rest
    :response: http-examples/sysapi/list_plugins.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

list with plugin module information


.. _ucapi_restful_install_pkg:

install a package
-----------------

Installs the :doc:`package </packages>`

Parameters:

* **API Key** API key with *master* permissions
* **m** package content (base64-encoded tar/tgz)
* **o** package setup options
* **w** wait (in seconds) before API call sends a response. This allows to try waiting until the package is installed


.. _ucapi_restful_shutdown_core:

shutdown the controller
-----------------------

Controller process will be exited and then (should be) restarted by watchdog. This allows to restart controller remotely.

For MQTT API calls a small shutdown delay usually should be specified to let the core send the correct API response.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/shutdown_core.rest
    :response: http-examples/sysapi/shutdown_core.resp-rest

Returns:

current boot id. This allows client to check is the controller restarted later, by comparing returned boot id and new boot id (obtained with "test" command)


.. _ucapi_restful_set_debug:

switch debugging mode
---------------------

Enables and disables debugging mode while the controller is running. After the controller is restarted, this parameter is lost and controller switches back to the mode specified in the configuration file.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_debug.rest
    :response: http-examples/sysapi/set_debug.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **debug** true for enabling debug mode, false for disabling


.. _ucapi_restful_login:

log in and get authentication token
-----------------------------------

Obtains authentication :doc:`token</api_tokens>` which can be used in API calls instead of API key.

If both **k** and **u** args are absent, but API method is called with HTTP request, which contain HTTP header for basic authorization, the function will try to parse it and log in user with credentials provided.

If authentication token is specified, the function will check it and return token information if it is valid.

If both token and credentials (user or API key) are specified, the function will return the token to normal mode.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/login.rest
    :response: http-examples/ucapi/login.resp-rest

Parameters:

* **API Key** valid API key or
* **u** user login
* **p** user password
* **a** authentication token

Returns:

A dict, containing API key ID and authentication token


.. _ucapi_restful_logout:

log out and purge authentication token
--------------------------------------

Purges authentication :doc:`token</api_tokens>`

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/logout.rest
    :response: http-examples/ucapi/logout.resp-rest

Parameters:

* **API Key** valid token


.. _ucapi_restful_set_token_readonly:

Set token read-only
-------------------

Applies read-only mode for token. In read-only mode, only read-only functions work, others return result_token_restricted(15).

The method works for token-authenticated API calls only.

To exit read-only mode, user must either re-login or, to keep the current token, call "login" API method with both token and user credentials.


.. _ucapi_restful_get_neighbor_clients:

Get neighbor clients
--------------------



Parameters:

* **API Key** valid API key
* **i** neightbor client id


.. _ucapi_restful_get_neighbor_clients:

Get neighbor clients
--------------------



Parameters:

* **API Key** valid API key
* **i** neightbor client id



.. _ucapi_restful_cat_item:

Item functions
==============



.. _ucapi_restful_q_clean:

clean action queue of unit
--------------------------

Cancels all queued actions, keeps the current action running.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/q_clean.rest
    :response: http-examples/ucapi/q_clean.resp-rest

Parameters:

* **API Key** valid API key


.. _ucapi_restful_disable_actions:

disable unit actions
--------------------

Disables unit to run and queue new actions.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/disable_actions.rest
    :response: http-examples/ucapi/disable_actions.resp-rest

Parameters:

* **API Key** valid API key


.. _ucapi_restful_enable_actions:

enable unit actions
-------------------

Enables unit to run and queue new actions.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/enable_actions.rest
    :response: http-examples/ucapi/enable_actions.resp-rest

Parameters:

* **API Key** valid API key


.. _ucapi_restful_result:

get action status
-----------------

Checks the result of the action by its UUID or returns the actions for the specified unit.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/result.rest
    :response: http-examples/ucapi/result.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **g** filter by unit group
* **s** filter by action status: Q for queued, R for running, F for finished

Returns:

list or single serialized action object


.. _ucapi_restful_groups:

get item group list
-------------------

Get the list of item groups. Useful e.g. for custom interfaces.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/groups.rest
    :response: http-examples/ucapi/groups.resp-rest

Parameters:

* **API Key** valid API key


.. _ucapi_restful_state:

get item state
--------------

State of the item or all items of the specified type can be obtained using state command.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/state.rest
    :response: http-examples/ucapi/state.resp-rest

Parameters:

* **API Key** valid API key

Optionally:



.. _ucapi_restful_state_history:

get item state history
----------------------

State history of one :doc:`item</items>` or several items of the specified type can be obtained using **state_history** command.

If master key is used, the method attempts to get stored state for an item even if it doesn't present currently in system.

The method can return state log for disconnected items as well.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/state_history.rest
    :response: http-examples/ucapi/state_history.resp-rest

Parameters:

* **API Key** valid API key
* **a** history notifier id (default: db_1)

Optionally:

* **s** start time (timestamp or ISO or e.g. 1D for -1 day)
* **e** end time (timestamp or ISO or e.g. 1D for -1 day)
* **l** records limit (doesn't work with "w")
* **x** state prop ("status" or "value")
* **t** time format ("iso" or "raw" for unix timestamp, default is "raw")
* **z** Time zone (pytz, e.g. UTC or Europe/Prague)
* **w** fill frame with the interval (e.g. "1T" - 1 min, "2H" - 2 hours etc.), start time is required, set to 1D if not specified
* **g** output format ("list", "dict" or "chart", default is "list")
* **c** options for chart (dict or comma separated)
* **o** extra options for notifier data request

Returns:

history data in specified format or chart image.

For chart, JSON RPC gets reply with "content_type" and "data" fields, where content is image content type. If PNG image format is selected, data is base64-encoded.

Options for chart (all are optional):

* type: chart type (line or bar, default is line)

* tf: chart time format

* out: output format (svg, png, default is svg),

* style: chart style (without "Style" suffix, e.g. Dark)

* other options: http://pygal.org/en/stable/documentation/configuration/chart.html#options (use range_min, range_max for range, other are passed as-is)

If option "w" (fill) is used, number of digits after comma may be specified. E.g. 5T:3 will output values with 3 digits after comma.

Additionally, SI prefix may be specified to convert value to kilos, megas etc, e.g. 5T:k:3 - divide value by 1000 and output 3 digits after comma. Valid prefixes are: k, M, G, T, P, E, Z, Y.

If binary prefix is required, it should be followed by "b", e.g. 5T:Mb:3 - divide value by 2^20 and output 3 digits after comma.


.. _ucapi_restful_state_log:

get item state log
------------------

State log of a single :doc:`item</items>` or group of the specified type can be obtained using **state_log** command.

note: only SQL notifiers are supported

Difference from state_history method:

* state_log doesn't optimize data to be displayed on charts * the data is returned from a database as-is * a single item OID or OID mask (e.g. sensor:env/#) can be specified

note: the method supports MQTT-style masks but only masks with wildcard-ending, like "type:group/subgroup/#" are supported.

The method can return state log for disconnected items as well.

For wildcard fetching, API key should have an access to the whole chosen group.

note: record limit means the limit for records, fetched from the database, but repeating state records are automatically grouped and the actual number of returned records can be lower than requested.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/state_log.rest
    :response: http-examples/ucapi/state_log.resp-rest

Parameters:

* **API Key** valid API key
* **a** history notifier id (default: db_1)

Optionally:

* **s** start time (timestamp or ISO or e.g. 1D for -1 day)
* **e** end time (timestamp or ISO or e.g. 1D for -1 day)
* **l** records limit (doesn't work with "w")
* **t** time format ("iso" or "raw" for unix timestamp, default is "raw")
* **z** Time zone (pytz, e.g. UTC or Europe/Prague)
* **o** extra options for notifier data request

Returns:

state log records (list)


.. _ucapi_restful_kill:

kill unit actions
-----------------

Apart from canceling all queued commands, this function also terminates the current running action.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/kill.rest
    :response: http-examples/ucapi/kill.resp-rest

Parameters:

* **API Key** valid API key

Returns:

If the current action of the unit cannot be terminated by configuration, the notice "pt" = "denied" will be returned additionally (even if there's no action running)


.. _ucapi_restful_start_item_maintenance:

start item maintenance mode
---------------------------

During maintenance mode all item updates are ignored, however actions still can be executed

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/start_item_maintenance.rest
    :response: http-examples/ucapi/start_item_maintenance.resp-rest

Parameters:

* **API Key** masterkey


.. _ucapi_restful_stop_item_maintenance:

stop item maintenance mode
--------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/stop_item_maintenance.rest
    :response: http-examples/ucapi/stop_item_maintenance.resp-rest

Parameters:

* **API Key** masterkey


.. _ucapi_restful_terminate:

terminate action execution
--------------------------

Terminates or cancel the action if it is still queued

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/terminate.rest
    :response: http-examples/ucapi/terminate.resp-rest

Parameters:

* **API Key** valid API key

Returns:

An error result will be returned eitner if action is terminated (Resource not found) or if termination process is failed or denied by unit configuration (Function failed)


.. _ucapi_restful_action_toggle:

toggle unit status
------------------

Create unit control action to toggle its status (1->0, 0->1)

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/action_toggle.rest
    :response: http-examples/ucapi/action_toggle.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **w** wait for the completion for the specified number of seconds
* **p** queue priority (default is 100, lower is better)
* **q** global queue timeout, if expires, action is marked as "dead"

Returns:

Serialized action object. If action is marked as dead, an error is returned (exception raised)


.. _ucapi_restful_action:

unit control action
-------------------

The call is considered successful when action is put into the action queue of selected unit.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/action.rest
    :response: http-examples/ucapi/action.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **s** desired unit status
* **v** desired unit value
* **w** wait for the completion for the specified number of seconds
* **p** queue priority (default is 100, lower is better)
* **q** global queue timeout, if expires, action is marked as "dead"

Returns:

Serialized action object. If action is marked as dead, an error is returned (exception raised)


.. _ucapi_restful_update:

update the status and value of the item
---------------------------------------

Updates the status and value of the :doc:`item</items>`. This is one of the ways of passive state update, for example with the use of an external controller.

.. note::

    Calling without **s** and **v** params will force item to perform     passive update requesting its status from update script or driver.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/update.rest
    :response: http-examples/ucapi/update.resp-rest

Parameters:

* **API Key** valid API key

Optionally:

* **s** item status
* **v** item value



.. _ucapi_restful_cat_item-management:

Item management
===============



.. _ucapi_restful_list:

list items
----------



Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **x** serialize specified item prop(s)

Returns:

the list of all :doc:`item</items>` available


.. _ucapi_restful_create_mu:

create multi-update
-------------------

Creates new :ref:`multi-update<multiupdate>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/create_mu.rest
    :response: http-examples/ucapi/create_mu.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save multi-update configuration immediately


.. _ucapi_restful_create_sensor:

create new sensor
-----------------

Creates new :ref:`sensor<sensor>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/create_sensor.rest
    :response: http-examples/ucapi/create_sensor.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save sensor configuration immediately


.. _ucapi_restful_create_unit:

create new unit
---------------

Creates new :ref:`unit<unit>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/create_unit.rest
    :response: http-examples/ucapi/create_unit.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save unit configuration immediately


.. _ucapi_restful_get_config:

get item configuration
----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_config.rest
    :response: http-examples/ucapi/get_config.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

complete :doc:`item</items>` configuration


.. _ucapi_restful_list_props:

list item properties
--------------------

Get all editable parameters of the :doc:`item</items>` confiugration.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_props.rest
    :response: http-examples/ucapi/list_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_save_config:

save item configuration
-----------------------

Saves :doc:`item</items>`. configuration on disk (even if it hasn't been changed)

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/save_config.rest
    :response: http-examples/ucapi/save_config.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_set_prop:

set item property
-----------------

Set configuration parameters of the :doc:`item</items>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/set_prop.rest
    :response: http-examples/ucapi/set_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _ucapi_restful_clone_group:

clone group
-----------

Creates a copy of all :doc:`items</items>` from the group.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/clone_group.rest
    :response: http-examples/ucapi/clone_group.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **n** new group to clone to

Optionally:

* **p** item ID prefix, e.g. device1. for device1.temp1, device1.fan1
* **r** iem ID prefix in the new group, e.g. device2 (both prefixes must be specified)
* **save** save configuration immediately


.. _ucapi_restful_clone:

clone item
----------

Creates a copy of the :doc:`item</items>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/clone.rest
    :response: http-examples/ucapi/clone.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **n** new item id

Optionally:

* **save** save multi-update configuration immediately



.. _ucapi_restful_cat_owfs:

1-Wire bus via OWFS
===================



.. _ucapi_restful_create_owfs_bus:

create OWFS bus
---------------

Creates (defines) :doc:`OWFS bus</owfs>` with the specified configuration.

Parameter "location" ("n") should contain the connection configuration, e.g.  "localhost:4304" for owhttpd or "i2c=/dev/i2c-1:ALL", "/dev/i2c-0 --w1" for local 1-Wire bus via I2C, depending on type.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/create_owfs_bus.rest
    :response: http-examples/ucapi/create_owfs_bus.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **n** OWFS location

Optionally:

* **l** lock port on operations, which means to wait while OWFS bus is used by other controller thread (driver command)
* **t** OWFS operations timeout (in seconds, default: default timeout)
* **r** retry attempts for each operation (default: no retries)
* **d** delay between bus operations (default: 50ms)
* **save** save OWFS bus config after creation

Returns:

If bus with the selected ID is already defined, error is not returned and bus is recreated.


.. _ucapi_restful_destroy_owfs_bus:

delete OWFS bus
---------------

Deletes (undefines) :doc:`OWFS bus</owfs>`.

.. note::

    In some cases deleted OWFS bus located on I2C may lock *libow*     library calls, which require controller restart until you can use     (create) the same I2C bus again.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/destroy_owfs_bus.rest
    :response: http-examples/ucapi/destroy_owfs_bus.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_owfs_bus:

get OWFS bus configuration
--------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_owfs_bus.rest
    :response: http-examples/ucapi/get_owfs_bus.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_owfs_buses:

list OWFS buses
---------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_owfs_buses.rest
    :response: http-examples/ucapi/list_owfs_buses.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_scan_owfs_bus:

scan OWFS bus
-------------

Scan :doc:`OWFS bus</owfs>` for connected 1-Wire devices.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/scan_owfs_bus.rest
    :response: http-examples/ucapi/scan_owfs_bus.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **p** specified equipment type (e.g. DS18S20,DS2405), list or comma separated
* **a** Equipment attributes (e.g. temperature, PIO), list comma separated
* **n** Equipment path
* **has_all** Equipment should have all specified attributes
* **full** obtain all attributes plus values

Returns:

If both "a" and "full" args are specified. the function will examine and values of attributes specified in "a" param. (This will poll "released" bus, even if locking is set up, so be careful with this feature in production environment).

Bus acquire error can be caused in 2 cases:

* bus is locked * owfs resource not initialized (libow or location problem)


.. _ucapi_restful_test_owfs_bus:

test OWFS bus
-------------

Verifies :doc:`OWFS bus</owfs>` checking library initialization status.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/test_owfs_bus.rest
    :response: http-examples/ucapi/test_owfs_bus.resp-rest

Parameters:

* **API Key** API key with *master* permissions



.. _ucapi_restful_cat_modbus:

Modbus ports
============



.. _ucapi_restful_create_modbus_port:

create virtual Modbus port
--------------------------

Creates virtual :doc:`Modbus port</modbus>` with the specified configuration.

Modbus params should contain the configuration of hardware Modbus port. The following hardware port types are supported:

* **tcp** , **udp** Modbus protocol implementations for TCP/IP     networks. The params should be specified as:     *<protocol>:<host>[:port]*, e.g.  *tcp:192.168.11.11:502*

* **rtu**, **ascii**, **binary** Modbus protocol implementations for     the local bus connected with USB or serial port. The params should     be specified as:     *<protocol>:<device>:<speed>:<data>:<parity>:<stop>* e.g.     *rtu:/dev/ttyS0:9600:8:E:1*

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/create_modbus_port.rest
    :response: http-examples/ucapi/create_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** Modbus params

Optionally:

* **l** lock port on operations, which means to wait while Modbus port is used by other controller thread (driver command)
* **t** Modbus operations timeout (in seconds, default: default timeout)
* **r** retry attempts for each operation (default: no retries)
* **d** delay between virtual port operations (default: 20ms)
* **save** save Modbus port config after creation

Returns:

If port with the selected ID is already created, error is not returned and port is recreated.


.. _ucapi_restful_destroy_modbus_port:

delete virtual Modbus port
--------------------------

Deletes virtual :doc:`Modbus port</modbus>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/destroy_modbus_port.rest
    :response: http-examples/ucapi/destroy_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_modbus_port:

get virtual Modbus port configuration
-------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_modbus_port.rest
    :response: http-examples/ucapi/get_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_modbus_ports:

list virtual Modbus ports
-------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_modbus_ports.rest
    :response: http-examples/ucapi/list_modbus_ports.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_read_modbus_port:

read Modbus register(s) from remote slave
-----------------------------------------

Modbus registers must be specified as list or comma separated memory addresses predicated with register type (h - holding, i - input, c - coil, d - discrete input).

Address ranges can be specified, e.g. h1000-1010,c10-15 will return values of holding registers from 1000 to 1010 and coil registers from 10 to 15

Float32 numbers are returned as Python-converted floats and may have broken precision. Consider converting back to f32 on the client side.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/read_modbus_port.rest
    :response: http-examples/ucapi/read_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **f** data type (u16, i16, u32, i32, u64, i64, f32 or bit)
* **c** count, if register range not specified

Optionally:

* **t** max allowed timeout for the operation


.. _ucapi_restful_test_modbus_port:

test virtual Modbus port
------------------------

Verifies virtual :doc:`Modbus port</modbus>` by calling connect() Modbus client method.

.. note::

    As Modbus UDP doesn't require a port to be connected, API call     always returns success unless the port is locked.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/test_modbus_port.rest
    :response: http-examples/ucapi/test_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_write_modbus_port:

write Modbus register(s) to remote slave
----------------------------------------

Modbus registers must be specified as list or comma separated memory addresses predicated with register type (h - holding, c - coil).

To set bit, specify register as hX/Y where X = register number, Y = bit number (supports u16, u32, u64 data types)

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/write_modbus_port.rest
    :response: http-examples/ucapi/write_modbus_port.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **v** register value(s) (integer or hex or list)
* **z** if True, use 0x05-06 commands (write single register/coil)
* **f** data type (u16, i16, u32, i32, u64, i64, f32), ignored if z=True

Optionally:

* **t** max allowed timeout for the operation


.. _ucapi_restful_get_modbus_slave_data:

get Modbus slave data
---------------------

Get data from Modbus slave memory space

Modbus registers must be specified as list or comma separated memory addresses predicated with register type (h - holding, i - input, c - coil, d - discrete input).

Address ranges can be specified, e.g. h1000-1010,c10-15 will return values of holding registers from 1000 to 1010 and coil registers from 10 to 15

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_modbus_slave_data.rest
    :response: http-examples/ucapi/get_modbus_slave_data.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **f** data type (u16, i16, u32, i32, u64, i64, f32 or bit)
* **c** count, if register range not specified



.. _ucapi_restful_cat_phi:

Physical interfaces (PHIs)
==========================



.. _ucapi_restful_unlink_phi_mod:

delete PHI module file
----------------------

Deletes PHI module file, if the module is loaded, all its instances should be unloaded first.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/unlink_phi_mod.rest
    :response: http-examples/ucapi/unlink_phi_mod.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_phi_discover:

discover installed equipment supported by PHI module
----------------------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/phi_discover.rest
    :response: http-examples/ucapi/phi_discover.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **x** interface to perform discover on
* **w** max time for the operation


.. _ucapi_restful_exec_phi:

execute additional PHI commands
-------------------------------

Execute PHI command and return execution result (as-is). **help** command returns all available commands.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/exec_phi.rest
    :response: http-examples/ucapi/exec_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **c** command to exec
* **a** command argument


.. _ucapi_restful_modinfo_phi:

get PHI module info
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/modinfo_phi.rest
    :response: http-examples/ucapi/modinfo_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_modhelp_phi:

get PHI usage help
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/modhelp_phi.rest
    :response: http-examples/ucapi/modhelp_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_phi_ports:

get list of PHI ports
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_phi_ports.rest
    :response: http-examples/ucapi/get_phi_ports.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_phi_mods:

get list of available PHI modules
---------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_phi_mods.rest
    :response: http-examples/ucapi/list_phi_mods.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_phi:

get loaded PHI information
--------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_phi.rest
    :response: http-examples/ucapi/get_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_phi:

list loaded PHIs
----------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_phi.rest
    :response: http-examples/ucapi/list_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **full** get exntended information


.. _ucapi_restful_load_phi:

load PHI module
---------------

Loads :doc:`Physical Interface</drivers>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/load_phi.rest
    :response: http-examples/ucapi/load_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **m** PHI module

Optionally:

* **c** PHI configuration
* **save** save driver configuration after successful call


.. _ucapi_restful_push_phi_state:

push state to PHI module
------------------------

Allows to perform update of PHI ports by external application.

If called as RESTful, the whole request body is used as a payload (except fields "k", "save", "kind" and "method", which are reserved)

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/push_phi_state.rest
    :response: http-examples/ucapi/push_phi_state.resp-rest

Parameters:

* **API Key** masterkey or a key with the write permission on "phi" group


.. _ucapi_restful_set_phi_prop:

set PHI configuration property
------------------------------

appends property to PHI configuration and reloads module

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/set_phi_prop.rest
    :response: http-examples/ucapi/set_phi_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save configuration after successful call


.. _ucapi_restful_test_phi:

test PHI
--------

Get PHI test result (as-is). All PHIs respond to **self** command, **help** command returns all available test commands.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/test_phi.rest
    :response: http-examples/ucapi/test_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_unload_phi:

unload PHI
----------

Unloads PHI. PHI should not be used by any :doc:`driver</drivers>` (except *default*, but the driver should not be in use by any :doc:`item</items>`).

If driver <phi_id.default> (which's loaded automatically with PHI) is present, it will be unloaded as well.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/unload_phi.rest
    :response: http-examples/ucapi/unload_phi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_put_phi_mod:

upload PHI module
-----------------

Allows to upload new PHI module to *xc/drivers/phi* folder.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/put_phi_mod.rest
    :response: http-examples/ucapi/put_phi_mod.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **c** module content

Optionally:

* **force** overwrite PHI module file if exists



.. _ucapi_restful_cat_driver:

LPI and drivers
===============



.. _ucapi_restful_assign_driver:

assign driver to item
---------------------

Sets the specified driver to :doc:`item</items>`, automatically updating item props:

* **action_driver_config**,**update_driver_config** to the specified     configuration * **action_exec**, **update_exec** to do all operations via driver     function calls (sets both to *|<driver_id>*)

To unassign driver, set driver ID to empty/null.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/assign_driver.rest
    :response: http-examples/ucapi/assign_driver.resp-rest

Parameters:

* **API Key** masterkey
* **d** driver ID (if none - all above item props are set to *null*)
* **c** configuration (e.g. port number)

Optionally:

* **save** save item configuration after successful call


.. _ucapi_restful_modinfo_lpi:

get LPI module info
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/modinfo_lpi.rest
    :response: http-examples/ucapi/modinfo_lpi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_modhelp_lpi:

get LPI usage help
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/modhelp_lpi.rest
    :response: http-examples/ucapi/modhelp_lpi.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_lpi_mods:

get list of available LPI modules
---------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_lpi_mods.rest
    :response: http-examples/ucapi/list_lpi_mods.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_driver:

get loaded driver information
-----------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_driver.rest
    :response: http-examples/ucapi/get_driver.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_drivers:

list loaded drivers
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_drivers.rest
    :response: http-examples/ucapi/list_drivers.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **full** get exntended information


.. _ucapi_restful_load_driver:

load a driver
-------------

Loads a :doc:`driver</drivers>`, combining previously loaded PHI and chosen LPI module.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/load_driver.rest
    :response: http-examples/ucapi/load_driver.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **m** LPI module

Optionally:

* **c** Driver (LPI) configuration, optional
* **save** save configuration after successful call


.. _ucapi_restful_set_driver_prop:

set driver (LPI) configuration property
---------------------------------------

appends property to LPI configuration and reloads module

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/set_driver_prop.rest
    :response: http-examples/ucapi/set_driver_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **save** save driver configuration after successful call


.. _ucapi_restful_unload_driver:

unload driver
-------------

Unloads driver. Driver should not be used by any :doc:`item</items>`.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/unload_driver.rest
    :response: http-examples/ucapi/unload_driver.resp-rest

Parameters:

* **API Key** API key with *master* permissions



.. _ucapi_restful_cat_datapuller:

Data pullers
============



.. _ucapi_restful_get_datapuller:

Get data puller
---------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/get_datapuller.rest
    :response: http-examples/ucapi/get_datapuller.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

Data puller info


.. _ucapi_restful_list_datapullers:

List data pullers
-----------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_datapullers.rest
    :response: http-examples/ucapi/list_datapullers.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

List of all configured data pullers


.. _ucapi_restful_restart_datapuller:

Restart data puller
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/restart_datapuller.rest
    :response: http-examples/ucapi/restart_datapuller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_start_datapuller:

Start data puller
-----------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/start_datapuller.rest
    :response: http-examples/ucapi/start_datapuller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_stop_datapuller:

Stop data puller
----------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/stop_datapuller.rest
    :response: http-examples/ucapi/stop_datapuller.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_create_datapuller:

create data puller
------------------

Creates :doc:`data puller</datapullers>` with the specified configuration.

Parameters:

* **API Key** API key with *master* permissions
* **i** data puller id
* **c** data puller command

Optionally:

* **t** data puller timeout (in seconds, default: default timeout)
* **e** event timeout (default: none)
* **save** save datapuller config after creation

Returns:

If datapuller with the selected ID is already created, error is not returned and datapuller is recreated.


.. _ucapi_restful_destroy_datapuller:

destroy data puller
-------------------

Creates :doc:`data puller</datapullers>` with the specified configuration.

Parameters:

* **API Key** API key with *master* permissions
* **i** data puller id



.. _ucapi_restful_cat_device:

Devices
=======



.. _ucapi_restful_undeploy_device:

delete device items
-------------------

Works in an opposite way to :ref:`ucapi_deploy_device` function, destroying all items specified in the template.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/undeploy_device.rest
    :response: http-examples/ucapi/undeploy_device.resp-rest

Parameters:

* **API Key** API key with *allow=device* permissions
* **t** device template (*runtime/tpl/<TEMPLATE>.yml|yaml|json*, without extension)

Optionally:

* **c** device config (*var=value*, comma separated or dict)

Returns:

The function ignores missing items, so no errors are returned unless device configuration file is invalid.


.. _ucapi_restful_deploy_device:

deploy device items from template
---------------------------------

Deploys the :ref:`device<device>` from the specified template.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/deploy_device.rest
    :response: http-examples/ucapi/deploy_device.resp-rest

Parameters:

* **API Key** API key with *allow=device* permissions

Optionally:

* **c** device config (*var=value*, comma separated or dict)
* **save** save items configuration on disk immediately after operation


.. _ucapi_restful_list_device_tpl:

list device templates
---------------------

List available device templates from runtime/tpl

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/list_device_tpl.rest
    :response: http-examples/ucapi/list_device_tpl.resp-rest

Parameters:

* **API Key** API key with *masterkey* permissions


.. _ucapi_restful_update_device:

update device items
-------------------

Works similarly to :ref:`ucapi_deploy_device` function but doesn't create new items, updating the item configuration of the existing ones.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/ucapi/update_device.rest
    :response: http-examples/ucapi/update_device.resp-rest

Parameters:

* **API Key** API key with *allow=device* permissions
* **t** device template (*runtime/tpl/<TEMPLATE>.yml|yaml|json*, without extension)

Optionally:

* **c** device config (*var=value*, comma separated or dict)
* **save** save items configuration on disk immediately after operation



.. _ucapi_restful_cat_cvar:

CVARs
=====



.. _ucapi_restful_get_cvar:

get the value of user-defined variable
--------------------------------------

.. note::

    Even if different EVA controllers are working on the same     server, they have different sets of variables To set the variables     for each subsystem, use SYS API on the respective address/port.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_cvar.rest
    :response: http-examples/sysapi/get_cvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:


Returns:

Dict containing variable and its value. If no varible name was specified, all cvars are returned.


.. _ucapi_restful_set_cvar:

set the value of user-defined variable
--------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_cvar.rest
    :response: http-examples/sysapi/set_cvar.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Optionally:

* **v** variable value (if not specified, variable is deleted)



.. _ucapi_restful_cat_lock:

Locking functions
=================



.. _ucapi_restful_lock:

acquire lock
------------

Locks can be used similarly to file locking by the specific process. The difference is that SYS API tokens can be:

* centralized for several systems (any EVA server can act as lock     server)

* removed from outside

* automatically unlocked after the expiration time, if the initiator     failed or forgot to release the lock

used to restrict parallel process starting or access to system files/resources. LM PLC :doc:`macro</lm/macros>` share locks with extrnal scripts.

.. note::

    Even if different EVA controllers are working on the same server,     their lock tokens are stored in different bases. To work with the     token of each subsystem, use SYS API on the respective     address/port.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/lock.rest
    :response: http-examples/sysapi/lock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions

Optionally:

* **t** maximum time (seconds) to acquire lock
* **e** time after which lock is automatically released (if absent, lock may be released only via unlock function)


.. _ucapi_restful_get_lock:

get lock status
---------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_lock.rest
    :response: http-examples/sysapi/get_lock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions


.. _ucapi_restful_unlock:

release lock
------------

Releases the previously acquired lock.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/unlock.rest
    :response: http-examples/sysapi/unlock.resp-rest

Parameters:

* **API Key** API key with *allow=lock* permissions



.. _ucapi_restful_cat_logs:

Logging
=======



.. _ucapi_restful_log:

put message to log file
-----------------------

An external application can put a message in the logs on behalf of the controller.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log.rest
    :response: http-examples/sysapi/log.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **l** log level
* **m** message text


.. _ucapi_restful_log_debug:

put debug message to log file
-----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _ucapi_restful_log_info:

put info message to log file
----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _ucapi_restful_log_warning:

put warning message to log file
-------------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _ucapi_restful_log_error:

put error message to log file
-----------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _ucapi_restful_log_critical:

put critical message to log file
--------------------------------

An external application can put a message in the logs on behalf of the controller.

Parameters:

* **API Key** API key with *sysfunc=yes* permissions
* **m** message text


.. _ucapi_restful_log_get:

get records from the controller log
-----------------------------------

Log records are stored in the controllers memory until restart or the time (keep_logmem) specified in controller configuration passes.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log_get.rest
    :response: http-examples/sysapi/log_get.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions

Optionally:

* **t** get log records not older than t seconds
* **n** the maximum number of log records you want to obtain
* **x** regex pattern filter


.. _ucapi_restful_log_rotate:

rotate log file
---------------

Deprecated, not required since 3.3.0

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/log_rotate.rest
    :response: http-examples/sysapi/log_rotate.resp-rest

Parameters:

* **API Key** API key with *sysfunc=yes* permissions


.. _ucapi_restful_api_log_get:

get API call log
----------------

* API call with master permission returns all records requested

* API call with other API key returns records for the specified key   only

* API call with an authentication token returns records for the   current authorized user

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/api_log_get.rest
    :response: http-examples/sysapi/api_log_get.resp-rest

Parameters:

* **API Key** any valid API key

Optionally:

* **s** start time (timestamp or ISO or e.g. 1D for -1 day)
* **e** end time (timestamp or ISO or e.g. 1D for -1 day)
* **n** records limit
* **t** time format ("iso" or "raw" for unix timestamp, default is "raw")
* **f** record filter (requires API key with master permission)

Returns:

List of API calls

Note: API call params are returned as string and can be invalid JSON data as they're always truncated to 512 symbols in log database

Record filter should be specified either as string (k1=val1,k2=val2) or as a dict. Valid fields are:

* gw: filter by API gateway

* ip: filter by caller IP

* auth: filter by authentication type

* u: filter by user

* utp: filter by user type

* ki: filter by API key ID

* func: filter by API function

* params: filter by API call params (matches if field contains value)

* status: filter by API call status



.. _ucapi_restful_cat_keys:

API keys
========



.. _ucapi_restful_check_item_access:

check access to the particular item
-----------------------------------

Does not check is supervisor lock set, also does not check the item really exist

Parameters:

* **API Key** valid API key
* **i** item id
* **p** item access ("r" for read, "w" for write)

Returns:

ok: true / false


.. _ucapi_restful_create_key:

create API key
--------------

API keys are defined statically in EVA registry config/<controller>/apikeys tree or can be created with API and stored in the user database.

Keys with the master permission can not be created.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/create_key.rest
    :response: http-examples/sysapi/create_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **save** save configuration immediately

Returns:

JSON with serialized key object


.. _ucapi_restful_destroy_key:

delete API key
--------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/destroy_key.rest
    :response: http-examples/sysapi/destroy_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_key_props:

list API key permissions
------------------------

Lists API key permissons (including a key itself)

.. note::

    API keys defined in EVA registry can not be managed with API.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_key_props.rest
    :response: http-examples/sysapi/list_key_props.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **save** save configuration immediately


.. _ucapi_restful_list_keys:

list API keys
-------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_keys.rest
    :response: http-examples/sysapi/list_keys.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_regenerate_key:

regenerate API key
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/regenerate_key.rest
    :response: http-examples/sysapi/regenerate_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions

Returns:

JSON dict with new key value in "key" field


.. _ucapi_restful_set_key_prop:

set API key permissions
-----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_key_prop.rest
    :response: http-examples/sysapi/set_key_prop.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** property
* **v** value (if none, permission will be revoked)
* **save** save configuration immediately



.. _ucapi_restful_cat_users:

User accounts
=============



.. _ucapi_restful_set_user_key:

assign API key to user
----------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_user_key.rest
    :response: http-examples/sysapi/set_user_key.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **a** API key to assign (key id, not a key itself) or multiple keys, comma separated


.. _ucapi_restful_create_user:

create user account
-------------------

.. note::

    All changes to user accounts are instant, if the system works in     read/only mode, set it to read/write before performing user     management.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/create_user.rest
    :response: http-examples/sysapi/create_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **p** user password
* **a** API key to assign (key id, not a key itself)


.. _ucapi_restful_destroy_user:

delete user account
-------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/destroy_user.rest
    :response: http-examples/sysapi/destroy_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_user:

get user account info
---------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_user.rest
    :response: http-examples/sysapi/get_user.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_users:

list user accounts
------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_users.rest
    :response: http-examples/sysapi/list_users.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_set_user_password:

set user password
-----------------

Either master key and user login must be specified or a user must be logged in and a session token used

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/set_user_password.rest
    :response: http-examples/sysapi/set_user_password.resp-rest

Parameters:

* **API Key** master key or token
* **p** new password


.. _ucapi_restful_list_tokens:

List active session tokens
--------------------------



Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_drop_tokens:

Drop session token(s)
---------------------



Parameters:

* **API Key** API key with *master* permissions
* **a** session token or
* **u** user name or
* **i** API key id



.. _ucapi_restful_cat_notifiers:

Notifier management
===================



.. _ucapi_restful_disable_notifier:

disable notifier
----------------

.. note::

    The notifier is disabled until controller restart. To disable     notifier permanently, use notifier management CLI.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/disable_notifier.rest
    :response: http-examples/sysapi/disable_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_enable_notifier:

enable notifier
---------------

.. note::

    The notifier is enabled until controller restart. To enable     notifier permanently, use notifier management CLI.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/enable_notifier.rest
    :response: http-examples/sysapi/enable_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_get_notifier:

get notifier configuration
--------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/get_notifier.rest
    :response: http-examples/sysapi/get_notifier.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_list_notifiers:

list notifiers
--------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_notifiers.rest
    :response: http-examples/sysapi/list_notifiers.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_restart_notifier:

restart notifier
----------------



Parameters:

* **API Key** API key with *master* permissions



.. _ucapi_restful_cat_files:

File management
===============



.. _ucapi_restful_file_put:

put file to runtime folder
--------------------------

Puts a new file into runtime folder. If the file with such name exists, it will be overwritten. As all files in runtime are text, binary data can not be put.

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_put.rest
    :response: http-examples/sysapi/file_put.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **m** file content (plain text or base64-encoded)
* **b** if True - put binary file (decode base64)


.. _ucapi_restful_file_set_exec:

set file exec permission
------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_set_exec.rest
    :response: http-examples/sysapi/file_set_exec.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **e** *false* for 0x644, *true* for 0x755 (executable)


.. _ucapi_restful_file_unlink:

delete file from runtime folder
-------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_unlink.rest
    :response: http-examples/sysapi/file_unlink.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_file_get:

get file contents from runtime folder
-------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/file_get.rest
    :response: http-examples/sysapi/file_get.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **b** if True - force getting binary file (base64-encode content)



.. _ucapi_restful_cat_corescript:

Core scripts
============



.. _ucapi_restful_list_corescript_mqtt_topics:

List MQTT topics core scripts react on
--------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/list_corescript_mqtt_topics.rest
    :response: http-examples/sysapi/list_corescript_mqtt_topics.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_reload_corescripts:

Reload core scripts if some was added or deleted
------------------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/reload_corescripts.rest
    :response: http-examples/sysapi/reload_corescripts.resp-rest

Parameters:

* **API Key** API key with *master* permissions


.. _ucapi_restful_subscribe_corescripts_mqtt:

Subscribe core scripts to MQTT topic
------------------------------------

The method subscribes core scripts to topic of default MQTT notifier (eva_1). To specify another notifier, set topic as <notifer_id>:<topic>

..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/subscribe_corescripts_mqtt.rest
    :response: http-examples/sysapi/subscribe_corescripts_mqtt.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **t** MQTT topic ("+" and "#" masks are supported)
* **q** MQTT topic QoS
* **save** save core script config after modification


.. _ucapi_restful_unsubscribe_corescripts_mqtt:

Unsubscribe core scripts from MQTT topic
----------------------------------------



..  http:example:: curl wget httpie python-requests
    :request: http-examples/sysapi/unsubscribe_corescripts_mqtt.rest
    :response: http-examples/sysapi/unsubscribe_corescripts_mqtt.resp-rest

Parameters:

* **API Key** API key with *master* permissions
* **t** MQTT topic ("+" and "#" masks are allowed)
* **save** save core script config after modification



.. _ucapi_restful_cat_registry:

Registry management
===================



.. _ucapi_restful_registry_safe_purge:

Safely purge registry database
------------------------------

Clears registry trash and invalid files. Keeps broken keys

Parameters:

* **API Key** API key with *sysfunc=yes* permissions


